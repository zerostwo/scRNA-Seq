configfile: "config/config.yaml"
SEURAT_OBJ = config["SEURAT_OBJ"]
GROUP = config["GROUP"]
TREATMENT = config["TREATMENT"]

import os
SAMPLES = os.path.basename(SEURAT_OBJ).split('.')[0]

rule all:
    input: 
        expand("results/{sample}/function/GO/{GROUP}.go.csv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/KEGG/{GROUP}.kegg.csv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSEA/{GROUP}.hallmark.gsea.rds", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSEA/{GROUP}.c2.gsea.rds", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSEA/{GROUP}.c5.gsea.rds", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/deg/{GROUP}.deg.csv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSVA/{GROUP}.hallmark.es.matrix.rds", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSVA/{GROUP}.kegg.es.matrix.rds", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/function/GSVA/{GROUP}.gobp.es.matrix.rds", sample=SAMPLES, GROUP=GROUP),
        # expand("results/{sample}/cor/{GROUP}.gene.cor.csv", sample=config["SAMPLES"], GROUP=GROUP),
        # expand("results/{sample}/cor/{GROUP}.hallmark.cor.csv", sample=SAMPLES, GROUP=GROUP),
        # expand("results/{sample}/cor/{GROUP}.kegg.cor.csv", sample=SAMPLES, GROUP=GROUP),
        # expand("results/{sample}/cor/{GROUP}.gobp.cor.csv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/scenic/{GROUP}/expr_mat.tsv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/scenic/{GROUP}/expr_mat.adjacencies.tsv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/scenic/{GROUP}/regulons.csv", sample=SAMPLES, GROUP=GROUP),
        expand("results/{sample}/scenic/{GROUP}/auc_mtx.csv", sample=SAMPLES, GROUP=GROUP)

# 1. 差异基因富集分析
include: "rules/deg.smk"
include: "rules/function.smk"
# 2. GSEA与GSVA分析
include: "rules/function_gsva.smk"
# 3. 转录调控网络分析
include: "rules/scenic.smk"

# 前期计算
## GSVA打分计算
## 细胞比例计算

# 相关性分析（选择感兴趣的基因）
## 基因与基因之间的表达相关性
## 基因与功能术语的GSVA得分相关性
## 基因与细胞比例的相关性

# 差异分析（按照感兴趣的基因表达与否定义为阳性阴性两组）
## 差异表达基因分析
## 差异表达基因功能富集分析
## 差异表达基因的GSEA
